BUG-012-missing-check-price-movements-import

---
id: BUG-012
type: bug
status: identified
priority: critical
severity: high
created: 2026-02-05
updated: 2026-02-05
---

# Missing check_price_movements Import Causing Deployment Crash

## Problem

Web service crashes on startup with ImportError, preventing entire system deployment.

Railway logs show:
```
ImportError: cannot import name 'check_price_movements' 
from 'crypto_news_aggregator.tasks.price_monitor' 
(/app/src/crypto_news_aggregator/tasks/price_monitor.py)
```

This prevents the web service from starting, which blocks Celery worker and beat from starting.

## Expected Behavior

- Web service should start successfully
- API routes should load without import errors
- Celery worker and beat should be able to connect

## Actual Behavior

- Web service crashes during module import phase
- FastAPI/Uvicorn never reaches "Application startup complete"
- Complete system outage
- No services running (web, worker, beat)

## Steps to Reproduce

1. Deploy current codebase to Railway
2. Web service attempts to start
3. Imports `crypto_news_aggregator.main`
4. main.py imports API router
5. API router imports `api/v1/tasks.py`
6. tasks.py line ~10 tries to import `check_price_movements`
7. ImportError raised → service crashes

## Environment

- Environment: production (Railway)
- Service: web (FastAPI/Uvicorn)
- User impact: high (complete system down)
- Affects: All services (web, worker, beat)

## Screenshots/Logs

From Railway web service logs:
```
File "/app/src/crypto_news_aggregator/api/v1/tasks.py", line 10, in <module>
    from crypto_news_aggregator.tasks.price_monitor import check_price_movements
ImportError: cannot import name 'check_price_movements' from 'crypto_news_aggregator.tasks.price_monitor'
```

Full traceback shows crash occurs during module loading, before application starts.

---

## Resolution

**Status:** ✅ FIXED (2026-02-06 01:50 UTC)
**Branch:** feature/cost-tracking-service
**Commits:**
- `c1bd804` - fix(tasks): remove non-existent check_price_movements import
- `618e4c7` - fix(tasks): remove price_monitor from autodiscover tasks (related)

### Root Cause (CONFIRMED)

The `check_price_movements` function never existed in `tasks/price_monitor.py`

**Import location:** `src/crypto_news_aggregator/tasks/__init__.py` (line 19)
**Also in:** `beat_schedule.py` (line 30)

**Why:** Likely planned feature that was never implemented, leaving stale imports behind

### Changes Made

**File 1: `src/crypto_news_aggregator/tasks/__init__.py`**
- ❌ Removed: `from .price_monitor import check_price_movements` (line 19)
- ❌ Removed: `"check_price_movements"` from `__all__` exports (line 42)

**File 2: `src/crypto_news_aggregator/tasks/beat_schedule.py`**
- ❌ Removed: `"check-price-movements"` task from beat schedule (lines 29-37)

**File 3: `src/crypto_news_aggregator/tasks/__init__.py`** (related BUG-013)
- ❌ Removed: `"crypto_news_aggregator.tasks.price_monitor"` from autodiscover_tasks list (line 51)

### Testing & Verification

**✅ Deployment verification (2026-02-06 01:34 UTC):**
1. ✅ Push fix to Railway
2. ✅ Web service started successfully (no import errors)
3. ✅ Celery worker connected and ready
4. ✅ 11 tasks registered (down from 12 - removed check_price_movements)
5. ✅ No ImportError for check_price_movements

**⏳ Next verification (after BUG-013 fix merges):**
1. Celery worker should process queued tasks
2. Run: `poetry run python scripts/test_briefing_trigger.py`
3. Verify briefing generation completes

**❌ Current blocker:**
Tasks are queued but worker shows "unregistered task" errors
→ Related to BUG-013 (autodiscover issue)
→ Fix: Remove price_monitor from autodiscover list (already committed)

### Files Changed

- `src/crypto_news_aggregator/api/v1/tasks.py` (remove/comment import on line ~10)

### Impact on Other Bugs

**✅ Positive impact achieved:**
- ✅ Unblocked BUG-011 verification (get_article_service fix was correct)
- ✅ All services now start (web, worker, beat)
- ⏳ Enables end-to-end testing (after BUG-013 fix)

**Related bugs:**
- BUG-011: Verified correct (function is being imported successfully)
- BUG-013: Discovered during fix (unregistered tasks) - FIX READY (618e4c7)

---

## BUG-013: Related Discovery

During BUG-012 fix testing, discovered that tasks registered during startup are not being found when Celery worker processes them.

**Error:** `Received unregistered task of type 'crypto_news_aggregator.tasks.fetch_news.fetch_news'`

**Root cause:** `app.autodiscover_tasks()` still includes `crypto_news_aggregator.tasks.price_monitor` module, which no longer has any Celery tasks.

**Fix:** Remove the module from autodiscover list (ALREADY COMMITTED: 618e4c7)

**Status:** ⏳ PR ready, awaiting merge to main