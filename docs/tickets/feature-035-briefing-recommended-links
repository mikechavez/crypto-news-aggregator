---
id: FEATURE-035
type: feature
status: blocked
priority: medium
complexity: low
created: 2026-02-06
updated: 2026-02-06
---

# Update Briefing Recommended Reading Links to Narrative Detail Pages

## Problem/Opportunity
Currently, the "Recommended Reading" section in briefings links to `/narratives` (the general list page), which:
- Forces users to manually find the recommended narrative
- Provides poor UX - user clicks and lands on wrong page
- Wastes the value of AI-generated recommendations
- Makes the feature feel broken/incomplete

**Example:**
```typescript
// Current - links to generic narratives page
<Link to="/narratives">
  Bitcoin Regulatory Framework Evolves
</Link>
```

**Desired:**
```typescript
// New - links to specific narrative detail page
<Link to="/narratives/507f1f77bcf86cd799439011">
  Bitcoin Regulatory Framework Evolves
</Link>
```

## Proposed Solution
Update the briefing's recommended reading links to point to individual narrative detail pages (`/narratives/:id`) instead of the generic narratives list.

**Requirements:**
1. Backend must include `narrative_id` in recommendation objects
2. Frontend must use `narrative_id` to construct detail page URLs
3. Links should open in same tab (user can browser-back to briefing)

## User Story
As a crypto analyst reading my briefing, I want to click on recommended narratives and land directly on their detail pages so that I can immediately dive deeper without searching.

## Acceptance Criteria
- [ ] Recommendation objects include `narrative_id` field (backend)
- [ ] Frontend constructs links as `/narratives/{narrative_id}`
- [ ] Clicking recommendation navigates to correct narrative detail page
- [ ] If narrative doesn't exist (404), shows error gracefully
- [ ] Links are visually distinct (hover state, color)
- [ ] Works for both morning and evening briefings

## Dependencies
- **FEATURE-034** - Narrative detail page must exist first (BLOCKING)

## Open Questions
- [x] Does backend already include narrative_id in recommendations? (Need to verify)
- [x] Should link open in new tab or same tab? (Same tab - better UX)
- [ ] What if narrative was archived/deleted? (Show error, suggest similar)

## Implementation Notes

### Step 1: Verify Backend Recommendation Format

**Check briefing generation:**
File: `src/crypto_news_aggregator/services/briefing_agent.py`

**Current format (assumed):**
```python
recommendations = [
    {
        "title": "Bitcoin Regulatory Framework Evolves",
        "theme": "market_regulation"
    }
]
```

**Required format:**
```python
recommendations = [
    {
        "narrative_id": "507f1f77bcf86cd799439011",  # ADD THIS
        "title": "Bitcoin Regulatory Framework Evolves",
        "theme": "market_regulation"
    }
]
```

**Where to add `narrative_id`:**
The briefing agent likely generates recommendations from the top narratives. When selecting narratives to recommend, capture their `_id` field:

```python
# In briefing generation logic
for narrative in top_narratives:
    recommendations.append({
        "narrative_id": str(narrative["_id"]),  # Convert ObjectId to string
        "title": narrative["title"],
        "theme": narrative["theme"]
    })
```

---

### Step 2: Update TypeScript Types

**File:** `context-owl-ui/src/types/index.ts` (or wherever types are defined)

**Update BriefingRecommendation type:**
```typescript
export interface BriefingRecommendation {
  narrative_id: string;  // ADD THIS
  title: string;
  theme: string;
}
```

---

### Step 3: Update Frontend Component

**File:** `context-owl-ui/src/pages/Briefing.tsx`  
**Function:** `RecommendationItem` (lines 73-88)

**Current implementation:**
```typescript
function RecommendationItem({ recommendation }: { recommendation: BriefingRecommendation }) {
  return (
    <Link
      to="/narratives"  // ❌ Wrong - goes to list page
      className="group block py-3"
    >
      <div className="flex items-start gap-3">
        <span className="text-gray-400 dark:text-gray-500 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors">
          &rarr;
        </span>
        <div>
          <p className="text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors font-medium">
            {recommendation.title}
          </p>
          <p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">
            {formatTheme(recommendation.theme)}
          </p>
        </div>
      </div>
    </Link>
  );
}
```

**New implementation:**
```typescript
function RecommendationItem({ recommendation }: { recommendation: BriefingRecommendation }) {
  return (
    <Link
      to={`/narratives/${recommendation.narrative_id}`}  // ✅ Correct - goes to detail page
      className="group block py-3"
    >
      <div className="flex items-start gap-3">
        <span className="text-gray-400 dark:text-gray-500 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors">
          &rarr;
        </span>
        <div>
          <p className="text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors font-medium">
            {recommendation.title}
          </p>
          <p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">
            {formatTheme(recommendation.theme)}
          </p>
        </div>
      </div>
    </Link>
  );
}
```

**Change:** 1 line (line 76)

---

### Step 4: Handle Missing narrative_id (Graceful Degradation)

**Scenario:** Older briefings generated before this feature may not have `narrative_id`

**Solution:** Fall back to list page if ID missing

```typescript
function RecommendationItem({ recommendation }: { recommendation: BriefingRecommendation }) {
  const linkTo = recommendation.narrative_id 
    ? `/narratives/${recommendation.narrative_id}`
    : `/narratives`;  // Fallback for old briefings

  return (
    <Link to={linkTo} className="group block py-3">
      {/* ... rest of component */}
    </Link>
  );
}
```

---

### Testing Steps

#### Backend Testing
1. Generate test briefing (manual or scheduled)
2. Check MongoDB `briefings` collection
3. Verify recommendations have `narrative_id` field
4. Verify IDs are valid (exist in `narratives` collection)

```python
# Test query
db.briefings.findOne({}, {"content.recommendations": 1}).sort({"generated_at": -1})

# Expected output:
{
  "content": {
    "recommendations": [
      {
        "narrative_id": "507f1f77bcf86cd799439011",
        "title": "...",
        "theme": "..."
      }
    ]
  }
}
```

#### Frontend Testing
1. Navigate to /briefing page
2. Scroll to "Recommended Reading" section
3. Hover over recommendation - verify link shows `/narratives/{id}`
4. Click recommendation - verify lands on correct narrative detail page
5. Verify theme badge still displays correctly
6. Test with old briefing (no narrative_id) - verify falls back to list page

---

### File Checklist

**Backend Files to Modify:**
- [ ] `src/crypto_news_aggregator/services/briefing_agent.py` (add narrative_id to recommendations)

**Frontend Files to Modify:**
- [ ] `context-owl-ui/src/types/index.ts` (update BriefingRecommendation interface)
- [ ] `context-owl-ui/src/pages/Briefing.tsx` (update RecommendationItem component)

**Total:** 3 files modified (2 backend, 1 frontend + 1 types)

---

### Edge Cases to Handle

1. **Narrative was deleted after briefing generated**
   - Click leads to 404 on detail page
   - Detail page shows "Narrative not found" error
   - User can navigate back to briefings

2. **Old briefing without narrative_id**
   - Gracefully falls back to `/narratives` list page
   - No errors thrown

3. **Invalid narrative_id format**
   - Backend validation should catch this
   - Detail page handles as 404

---

### Estimated Effort
- Backend changes: 30 min (add narrative_id to recommendations)
- Frontend changes: 15 min (update link logic)
- Testing: 15 min
- **Total: 1 hour**

---

### Success Metrics
- [ ] 100% of new recommendations have narrative_id
- [ ] Click-through rate on recommendations improves (vs old version)
- [ ] Zero navigation errors (links work correctly)
- [ ] Backward compatible (old briefings still work)

---

## Completion Summary
<!-- Fill in after completion -->
- Actual complexity:
- Key decisions made:
- Deviations from plan:
- Backward compatibility tested:
- Old briefings behavior: